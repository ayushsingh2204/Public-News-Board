{"ast":null,"code":"function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nimport React, { forwardRef, useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport styled, { ThemeContext } from 'styled-components';\nimport { selectedStyle, setFocusWithoutScroll } from '../../utils';\nimport { defaultProps } from '../../default-props';\nimport { Box } from '../Box';\nimport { Button } from '../Button';\nimport { InfiniteScroll } from '../InfiniteScroll';\nimport { Keyboard } from '../Keyboard';\nimport { Text } from '../Text';\nimport { TextInput } from '../TextInput';\nimport { StyledContainer } from './StyledSelect';\nimport { applyKey } from './utils'; // position relative is so scroll can be managed correctly\n\nvar OptionsBox = styled.div.withConfig({\n  displayName: \"SelectContainer__OptionsBox\",\n  componentId: \"sc-1wi0ul8-0\"\n})([\"position:relative;scroll-behavior:smooth;overflow:auto;outline:none;\"]);\nvar OptionBox = styled(Box).withConfig({\n  displayName: \"SelectContainer__OptionBox\",\n  componentId: \"sc-1wi0ul8-1\"\n})([\"\", \"\"], function (props) {\n  return props.selected && selectedStyle;\n});\nvar SelectOption = styled(Button).withConfig({\n  displayName: \"SelectContainer__SelectOption\",\n  componentId: \"sc-1wi0ul8-2\"\n})([\"display:block;width:100%;\"]);\n\nvar ClearButton = function ClearButton(_ref) {\n  var clear = _ref.clear,\n      onClear = _ref.onClear,\n      name = _ref.name,\n      theme = _ref.theme,\n      setFocus = _ref.setFocus;\n  var label = clear.label,\n      position = clear.position;\n  var align = position !== 'bottom' ? 'start' : 'center';\n  var buttonLabel = label || \"Clear \" + (name || 'selection');\n  return /*#__PURE__*/React.createElement(Button, {\n    onClick: onClear,\n    onFocus: function onFocus() {\n      return setFocus(true);\n    },\n    onBlur: function onBlur() {\n      return setFocus(false);\n    }\n  }, /*#__PURE__*/React.createElement(Box, _extends({}, theme.select.clear.container, {\n    align: align\n  }), /*#__PURE__*/React.createElement(Text, theme.select.clear.text, buttonLabel)));\n};\n\nvar SelectContainer = /*#__PURE__*/forwardRef(function (_ref2, ref) {\n  var clear = _ref2.clear,\n      _ref2$children = _ref2.children,\n      children = _ref2$children === void 0 ? null : _ref2$children,\n      disabled = _ref2.disabled,\n      disabledKey = _ref2.disabledKey,\n      dropHeight = _ref2.dropHeight,\n      _ref2$emptySearchMess = _ref2.emptySearchMessage,\n      emptySearchMessage = _ref2$emptySearchMess === void 0 ? 'No matches found' : _ref2$emptySearchMess,\n      id = _ref2.id,\n      labelKey = _ref2.labelKey,\n      multiple = _ref2.multiple,\n      name = _ref2.name,\n      onChange = _ref2.onChange,\n      onKeyDown = _ref2.onKeyDown,\n      onMore = _ref2.onMore,\n      onSearch = _ref2.onSearch,\n      optionIndexesInValue = _ref2.optionIndexesInValue,\n      options = _ref2.options,\n      searchPlaceholder = _ref2.searchPlaceholder,\n      selected = _ref2.selected,\n      _ref2$value = _ref2.value,\n      value = _ref2$value === void 0 ? '' : _ref2$value,\n      valueKey = _ref2.valueKey,\n      _ref2$replace = _ref2.replace,\n      replace = _ref2$replace === void 0 ? true : _ref2$replace;\n  var theme = useContext(ThemeContext) || defaultProps.theme;\n\n  var _useState = useState(),\n      search = _useState[0],\n      setSearch = _useState[1];\n\n  var _useState2 = useState(-1),\n      activeIndex = _useState2[0],\n      setActiveIndex = _useState2[1];\n\n  var _useState3 = useState(),\n      keyboardNavigation = _useState3[0],\n      setKeyboardNavigation = _useState3[1];\n\n  var _useState4 = useState(false),\n      focus = _useState4[0],\n      setFocus = _useState4[1];\n\n  var _useState5 = useState(options),\n      initialOptions = _useState5[0];\n\n  var searchRef = useRef();\n  var optionsRef = useRef(); // adjust activeIndex when options change\n\n  useEffect(function () {\n    if (activeIndex === -1 && search && optionIndexesInValue.length) {\n      setActiveIndex(optionIndexesInValue[0]);\n    }\n  }, [activeIndex, optionIndexesInValue, search]); // set initial focus\n\n  useEffect(function () {\n    // need to wait for Drop to be ready\n    var timer = setTimeout(function () {\n      var optionsNode = optionsRef.current;\n\n      if (onSearch) {\n        var searchInput = searchRef.current;\n\n        if (searchInput && searchInput.focus) {\n          setFocusWithoutScroll(searchInput);\n        }\n      } else if (optionsNode) {\n        setFocusWithoutScroll(optionsNode);\n      }\n    }, 100);\n    return function () {\n      return clearTimeout(timer);\n    };\n  }, [onSearch]); // clear keyboardNavigation after a while\n\n  useEffect(function () {\n    if (keyboardNavigation) {\n      // 100ms was empirically determined\n      var timer = setTimeout(function () {\n        return setKeyboardNavigation(false);\n      }, 100);\n      return function () {\n        return clearTimeout(timer);\n      };\n    }\n\n    return undefined;\n  }, [keyboardNavigation]);\n  var optionLabel = useCallback(function (index) {\n    return applyKey(options[index], labelKey);\n  }, [labelKey, options]);\n  var optionValue = useCallback(function (index) {\n    return applyKey(options[index], valueKey);\n  }, [options, valueKey]);\n  var isDisabled = useCallback(function (index) {\n    var option = options[index];\n    var result;\n\n    if (disabledKey) {\n      result = applyKey(option, disabledKey);\n    } else if (Array.isArray(disabled)) {\n      if (typeof disabled[0] === 'number') {\n        result = disabled.indexOf(index) !== -1;\n      } else {\n        var optionVal = optionValue(index);\n        result = disabled.indexOf(optionVal) !== -1;\n      }\n    }\n\n    return result;\n  }, [disabled, disabledKey, options, optionValue]);\n  var isSelected = useCallback(function (index) {\n    var result;\n\n    if (selected) {\n      // deprecated in favor of value\n      result = selected.indexOf(index) !== -1;\n    } else {\n      var optionVal = optionValue(index);\n\n      if (Array.isArray(value)) {\n        if (value.length === 0) {\n          result = false;\n        } else if (typeof value[0] !== 'object') {\n          result = value.indexOf(optionVal) !== -1;\n        } else if (valueKey) {\n          result = value.some(function (valueItem) {\n            var valueValue = typeof valueKey === 'function' ? valueKey(valueItem) : valueItem[valueKey];\n            return valueValue === optionVal;\n          });\n        }\n      } else if (valueKey && typeof value === 'object') {\n        var valueValue = typeof valueKey === 'function' ? valueKey(value) : value[valueKey];\n        result = valueValue === optionVal;\n      } else {\n        result = value === optionVal;\n      }\n    }\n\n    return result;\n  }, [optionValue, selected, value, valueKey]);\n  var selectOption = useCallback(function (index) {\n    return function (event) {\n      if (onChange) {\n        var nextValue;\n        var nextSelected;\n\n        if (multiple) {\n          var nextOptionIndexesInValue = optionIndexesInValue.slice(0);\n          var initialOptionsIndex = initialOptions.indexOf(options[index]);\n          var valueIndex = optionIndexesInValue.indexOf(initialOptionsIndex);\n\n          if (valueIndex === -1) {\n            nextOptionIndexesInValue.push(initialOptionsIndex);\n          } else {\n            nextOptionIndexesInValue.splice(valueIndex, 1);\n          }\n\n          nextValue = nextOptionIndexesInValue.map(function (i) {\n            return valueKey && valueKey.reduce ? applyKey(initialOptions[i], valueKey) : initialOptions[i];\n          });\n          nextSelected = nextOptionIndexesInValue;\n        } else {\n          nextValue = valueKey && valueKey.reduce ? applyKey(options[index], valueKey) : options[index];\n          nextSelected = index;\n        }\n\n        onChange(event, {\n          option: options[index],\n          value: nextValue,\n          selected: nextSelected\n        });\n      }\n    };\n  }, [multiple, onChange, optionIndexesInValue, initialOptions, options, valueKey]);\n  var onClear = useCallback(function (event) {\n    onChange(event, {\n      option: undefined,\n      value: '',\n      selected: ''\n    });\n  }, [onChange]);\n  var onNextOption = useCallback(function (event) {\n    event.preventDefault();\n    var nextActiveIndex = activeIndex + 1;\n\n    while (nextActiveIndex < options.length && isDisabled(nextActiveIndex)) {\n      nextActiveIndex += 1;\n    }\n\n    if (nextActiveIndex !== options.length) {\n      setActiveIndex(nextActiveIndex);\n      setKeyboardNavigation(true);\n    }\n  }, [activeIndex, isDisabled, options]);\n  var onPreviousOption = useCallback(function (event) {\n    event.preventDefault();\n    var nextActiveIndex = activeIndex - 1;\n\n    while (nextActiveIndex >= 0 && isDisabled(nextActiveIndex)) {\n      nextActiveIndex -= 1;\n    }\n\n    if (nextActiveIndex >= 0) {\n      setActiveIndex(nextActiveIndex);\n      setKeyboardNavigation(true);\n    }\n  }, [activeIndex, isDisabled]);\n  var onActiveOption = useCallback(function (index) {\n    return function () {\n      if (!keyboardNavigation) setActiveIndex(index);\n    };\n  }, [keyboardNavigation]);\n  var onSelectOption = useCallback(function (event) {\n    if (activeIndex >= 0 && !focus) {\n      event.preventDefault(); // prevent submitting forms\n\n      selectOption(activeIndex)(event);\n    }\n  }, [activeIndex, selectOption, focus]);\n  var customSearchInput = theme.select.searchInput;\n  var SelectTextInput = customSearchInput || TextInput;\n  var selectOptionsStyle = theme.select.options ? _extends({}, theme.select.options.box, theme.select.options.container) : {};\n  return /*#__PURE__*/React.createElement(Keyboard, {\n    onEnter: onSelectOption,\n    onUp: onPreviousOption,\n    onDown: onNextOption,\n    onKeyDown: onKeyDown\n  }, /*#__PURE__*/React.createElement(StyledContainer, {\n    ref: ref,\n    as: Box,\n    id: id ? id + \"__select-drop\" : undefined,\n    dropHeight: dropHeight\n  }, onSearch && /*#__PURE__*/React.createElement(Box, {\n    pad: !customSearchInput ? 'xsmall' : undefined,\n    flex: false\n  }, /*#__PURE__*/React.createElement(SelectTextInput, {\n    focusIndicator: !customSearchInput,\n    size: \"small\",\n    ref: searchRef,\n    type: \"search\",\n    value: search || '',\n    placeholder: searchPlaceholder,\n    onChange: function onChange(event) {\n      var nextSearch = event.target.value;\n      setSearch(nextSearch);\n      setActiveIndex(-1);\n      onSearch(nextSearch);\n    }\n  })), clear && clear.position !== 'bottom' && value && /*#__PURE__*/React.createElement(ClearButton, {\n    clear: clear,\n    name: name,\n    onClear: onClear,\n    theme: theme,\n    setFocus: setFocus\n  }), /*#__PURE__*/React.createElement(OptionsBox, {\n    role: \"menubar\",\n    tabIndex: \"-1\",\n    ref: optionsRef\n  }, options.length > 0 ? /*#__PURE__*/React.createElement(InfiniteScroll, {\n    items: options,\n    step: theme.select.step,\n    onMore: onMore,\n    replace: replace,\n    show: activeIndex !== -1 ? activeIndex : undefined\n  }, function (option, index, optionRef) {\n    var optionDisabled = isDisabled(index);\n    var optionSelected = isSelected(index);\n    var optionActive = activeIndex === index; // Determine whether the label is done as a child or\n    // as an option Button kind property.\n\n    var child;\n    if (children) child = children(option, index, options, {\n      active: optionActive,\n      disabled: optionDisabled,\n      selected: optionSelected\n    });else if (theme.select.options) child = /*#__PURE__*/React.createElement(OptionBox, _extends({}, selectOptionsStyle, {\n      selected: optionSelected\n    }), /*#__PURE__*/React.createElement(Text, theme.select.options.text, optionLabel(index))); // if we have a child, turn on plain, and hoverIndicator\n\n    return /*#__PURE__*/React.createElement(SelectOption // eslint-disable-next-line react/no-array-index-key\n    , {\n      key: index,\n      ref: optionRef,\n      tabIndex: \"-1\",\n      role: \"menuitem\",\n      plain: !child ? undefined : true,\n      align: \"start\",\n      kind: !child ? 'option' : undefined,\n      hoverIndicator: !child ? undefined : 'background',\n      label: !child ? optionLabel(index) : undefined,\n      disabled: optionDisabled || undefined,\n      active: optionActive,\n      selected: optionSelected,\n      option: option,\n      onMouseOver: !optionDisabled ? onActiveOption(index) : undefined,\n      onClick: !optionDisabled ? selectOption(index) : undefined\n    }, child);\n  }) : /*#__PURE__*/React.createElement(SelectOption, {\n    key: \"search_empty\",\n    tabIndex: \"-1\",\n    role: \"menuitem\",\n    hoverIndicator: \"background\",\n    disabled: true,\n    option: emptySearchMessage\n  }, /*#__PURE__*/React.createElement(OptionBox, selectOptionsStyle, /*#__PURE__*/React.createElement(Text, theme.select.container.text, emptySearchMessage)))), clear && clear.position === 'bottom' && value && /*#__PURE__*/React.createElement(ClearButton, {\n    clear: clear,\n    name: name,\n    onClear: onClear,\n    theme: theme,\n    setFocus: setFocus\n  })));\n});\nexport { SelectContainer };","map":{"version":3,"sources":["D:/React Gormmet/react-gormmet/node_modules/grommet/es6/components/Select/SelectContainer.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","React","forwardRef","useCallback","useContext","useEffect","useRef","useState","styled","ThemeContext","selectedStyle","setFocusWithoutScroll","defaultProps","Box","Button","InfiniteScroll","Keyboard","Text","TextInput","StyledContainer","applyKey","OptionsBox","div","withConfig","displayName","componentId","OptionBox","props","selected","SelectOption","ClearButton","_ref","clear","onClear","name","theme","setFocus","label","position","align","buttonLabel","createElement","onClick","onFocus","onBlur","select","container","text","SelectContainer","_ref2","ref","_ref2$children","children","disabled","disabledKey","dropHeight","_ref2$emptySearchMess","emptySearchMessage","id","labelKey","multiple","onChange","onKeyDown","onMore","onSearch","optionIndexesInValue","options","searchPlaceholder","_ref2$value","value","valueKey","_ref2$replace","replace","_useState","search","setSearch","_useState2","activeIndex","setActiveIndex","_useState3","keyboardNavigation","setKeyboardNavigation","_useState4","focus","_useState5","initialOptions","searchRef","optionsRef","timer","setTimeout","optionsNode","current","searchInput","clearTimeout","undefined","optionLabel","index","optionValue","isDisabled","option","result","Array","isArray","indexOf","optionVal","isSelected","some","valueItem","valueValue","selectOption","event","nextValue","nextSelected","nextOptionIndexesInValue","slice","initialOptionsIndex","valueIndex","push","splice","map","reduce","onNextOption","preventDefault","nextActiveIndex","onPreviousOption","onActiveOption","onSelectOption","customSearchInput","SelectTextInput","selectOptionsStyle","box","onEnter","onUp","onDown","as","pad","flex","focusIndicator","size","type","placeholder","nextSearch","role","tabIndex","items","step","show","optionRef","optionDisabled","optionSelected","optionActive","child","active","plain","kind","hoverIndicator","onMouseOver"],"mappings":"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","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { forwardRef, useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport styled, { ThemeContext } from 'styled-components';\nimport { selectedStyle, setFocusWithoutScroll } from '../../utils';\nimport { defaultProps } from '../../default-props';\nimport { Box } from '../Box';\nimport { Button } from '../Button';\nimport { InfiniteScroll } from '../InfiniteScroll';\nimport { Keyboard } from '../Keyboard';\nimport { Text } from '../Text';\nimport { TextInput } from '../TextInput';\nimport { StyledContainer } from './StyledSelect';\nimport { applyKey } from './utils'; // position relative is so scroll can be managed correctly\n\nvar OptionsBox = styled.div.withConfig({\n  displayName: \"SelectContainer__OptionsBox\",\n  componentId: \"sc-1wi0ul8-0\"\n})([\"position:relative;scroll-behavior:smooth;overflow:auto;outline:none;\"]);\nvar OptionBox = styled(Box).withConfig({\n  displayName: \"SelectContainer__OptionBox\",\n  componentId: \"sc-1wi0ul8-1\"\n})([\"\", \"\"], function (props) {\n  return props.selected && selectedStyle;\n});\nvar SelectOption = styled(Button).withConfig({\n  displayName: \"SelectContainer__SelectOption\",\n  componentId: \"sc-1wi0ul8-2\"\n})([\"display:block;width:100%;\"]);\n\nvar ClearButton = function ClearButton(_ref) {\n  var clear = _ref.clear,\n      onClear = _ref.onClear,\n      name = _ref.name,\n      theme = _ref.theme,\n      setFocus = _ref.setFocus;\n  var label = clear.label,\n      position = clear.position;\n  var align = position !== 'bottom' ? 'start' : 'center';\n  var buttonLabel = label || \"Clear \" + (name || 'selection');\n  return /*#__PURE__*/React.createElement(Button, {\n    onClick: onClear,\n    onFocus: function onFocus() {\n      return setFocus(true);\n    },\n    onBlur: function onBlur() {\n      return setFocus(false);\n    }\n  }, /*#__PURE__*/React.createElement(Box, _extends({}, theme.select.clear.container, {\n    align: align\n  }), /*#__PURE__*/React.createElement(Text, theme.select.clear.text, buttonLabel)));\n};\n\nvar SelectContainer = /*#__PURE__*/forwardRef(function (_ref2, ref) {\n  var clear = _ref2.clear,\n      _ref2$children = _ref2.children,\n      children = _ref2$children === void 0 ? null : _ref2$children,\n      disabled = _ref2.disabled,\n      disabledKey = _ref2.disabledKey,\n      dropHeight = _ref2.dropHeight,\n      _ref2$emptySearchMess = _ref2.emptySearchMessage,\n      emptySearchMessage = _ref2$emptySearchMess === void 0 ? 'No matches found' : _ref2$emptySearchMess,\n      id = _ref2.id,\n      labelKey = _ref2.labelKey,\n      multiple = _ref2.multiple,\n      name = _ref2.name,\n      onChange = _ref2.onChange,\n      onKeyDown = _ref2.onKeyDown,\n      onMore = _ref2.onMore,\n      onSearch = _ref2.onSearch,\n      optionIndexesInValue = _ref2.optionIndexesInValue,\n      options = _ref2.options,\n      searchPlaceholder = _ref2.searchPlaceholder,\n      selected = _ref2.selected,\n      _ref2$value = _ref2.value,\n      value = _ref2$value === void 0 ? '' : _ref2$value,\n      valueKey = _ref2.valueKey,\n      _ref2$replace = _ref2.replace,\n      replace = _ref2$replace === void 0 ? true : _ref2$replace;\n  var theme = useContext(ThemeContext) || defaultProps.theme;\n\n  var _useState = useState(),\n      search = _useState[0],\n      setSearch = _useState[1];\n\n  var _useState2 = useState(-1),\n      activeIndex = _useState2[0],\n      setActiveIndex = _useState2[1];\n\n  var _useState3 = useState(),\n      keyboardNavigation = _useState3[0],\n      setKeyboardNavigation = _useState3[1];\n\n  var _useState4 = useState(false),\n      focus = _useState4[0],\n      setFocus = _useState4[1];\n\n  var _useState5 = useState(options),\n      initialOptions = _useState5[0];\n\n  var searchRef = useRef();\n  var optionsRef = useRef(); // adjust activeIndex when options change\n\n  useEffect(function () {\n    if (activeIndex === -1 && search && optionIndexesInValue.length) {\n      setActiveIndex(optionIndexesInValue[0]);\n    }\n  }, [activeIndex, optionIndexesInValue, search]); // set initial focus\n\n  useEffect(function () {\n    // need to wait for Drop to be ready\n    var timer = setTimeout(function () {\n      var optionsNode = optionsRef.current;\n\n      if (onSearch) {\n        var searchInput = searchRef.current;\n\n        if (searchInput && searchInput.focus) {\n          setFocusWithoutScroll(searchInput);\n        }\n      } else if (optionsNode) {\n        setFocusWithoutScroll(optionsNode);\n      }\n    }, 100);\n    return function () {\n      return clearTimeout(timer);\n    };\n  }, [onSearch]); // clear keyboardNavigation after a while\n\n  useEffect(function () {\n    if (keyboardNavigation) {\n      // 100ms was empirically determined\n      var timer = setTimeout(function () {\n        return setKeyboardNavigation(false);\n      }, 100);\n      return function () {\n        return clearTimeout(timer);\n      };\n    }\n\n    return undefined;\n  }, [keyboardNavigation]);\n  var optionLabel = useCallback(function (index) {\n    return applyKey(options[index], labelKey);\n  }, [labelKey, options]);\n  var optionValue = useCallback(function (index) {\n    return applyKey(options[index], valueKey);\n  }, [options, valueKey]);\n  var isDisabled = useCallback(function (index) {\n    var option = options[index];\n    var result;\n\n    if (disabledKey) {\n      result = applyKey(option, disabledKey);\n    } else if (Array.isArray(disabled)) {\n      if (typeof disabled[0] === 'number') {\n        result = disabled.indexOf(index) !== -1;\n      } else {\n        var optionVal = optionValue(index);\n        result = disabled.indexOf(optionVal) !== -1;\n      }\n    }\n\n    return result;\n  }, [disabled, disabledKey, options, optionValue]);\n  var isSelected = useCallback(function (index) {\n    var result;\n\n    if (selected) {\n      // deprecated in favor of value\n      result = selected.indexOf(index) !== -1;\n    } else {\n      var optionVal = optionValue(index);\n\n      if (Array.isArray(value)) {\n        if (value.length === 0) {\n          result = false;\n        } else if (typeof value[0] !== 'object') {\n          result = value.indexOf(optionVal) !== -1;\n        } else if (valueKey) {\n          result = value.some(function (valueItem) {\n            var valueValue = typeof valueKey === 'function' ? valueKey(valueItem) : valueItem[valueKey];\n            return valueValue === optionVal;\n          });\n        }\n      } else if (valueKey && typeof value === 'object') {\n        var valueValue = typeof valueKey === 'function' ? valueKey(value) : value[valueKey];\n        result = valueValue === optionVal;\n      } else {\n        result = value === optionVal;\n      }\n    }\n\n    return result;\n  }, [optionValue, selected, value, valueKey]);\n  var selectOption = useCallback(function (index) {\n    return function (event) {\n      if (onChange) {\n        var nextValue;\n        var nextSelected;\n\n        if (multiple) {\n          var nextOptionIndexesInValue = optionIndexesInValue.slice(0);\n          var initialOptionsIndex = initialOptions.indexOf(options[index]);\n          var valueIndex = optionIndexesInValue.indexOf(initialOptionsIndex);\n\n          if (valueIndex === -1) {\n            nextOptionIndexesInValue.push(initialOptionsIndex);\n          } else {\n            nextOptionIndexesInValue.splice(valueIndex, 1);\n          }\n\n          nextValue = nextOptionIndexesInValue.map(function (i) {\n            return valueKey && valueKey.reduce ? applyKey(initialOptions[i], valueKey) : initialOptions[i];\n          });\n          nextSelected = nextOptionIndexesInValue;\n        } else {\n          nextValue = valueKey && valueKey.reduce ? applyKey(options[index], valueKey) : options[index];\n          nextSelected = index;\n        }\n\n        onChange(event, {\n          option: options[index],\n          value: nextValue,\n          selected: nextSelected\n        });\n      }\n    };\n  }, [multiple, onChange, optionIndexesInValue, initialOptions, options, valueKey]);\n  var onClear = useCallback(function (event) {\n    onChange(event, {\n      option: undefined,\n      value: '',\n      selected: ''\n    });\n  }, [onChange]);\n  var onNextOption = useCallback(function (event) {\n    event.preventDefault();\n    var nextActiveIndex = activeIndex + 1;\n\n    while (nextActiveIndex < options.length && isDisabled(nextActiveIndex)) {\n      nextActiveIndex += 1;\n    }\n\n    if (nextActiveIndex !== options.length) {\n      setActiveIndex(nextActiveIndex);\n      setKeyboardNavigation(true);\n    }\n  }, [activeIndex, isDisabled, options]);\n  var onPreviousOption = useCallback(function (event) {\n    event.preventDefault();\n    var nextActiveIndex = activeIndex - 1;\n\n    while (nextActiveIndex >= 0 && isDisabled(nextActiveIndex)) {\n      nextActiveIndex -= 1;\n    }\n\n    if (nextActiveIndex >= 0) {\n      setActiveIndex(nextActiveIndex);\n      setKeyboardNavigation(true);\n    }\n  }, [activeIndex, isDisabled]);\n  var onActiveOption = useCallback(function (index) {\n    return function () {\n      if (!keyboardNavigation) setActiveIndex(index);\n    };\n  }, [keyboardNavigation]);\n  var onSelectOption = useCallback(function (event) {\n    if (activeIndex >= 0 && !focus) {\n      event.preventDefault(); // prevent submitting forms\n\n      selectOption(activeIndex)(event);\n    }\n  }, [activeIndex, selectOption, focus]);\n  var customSearchInput = theme.select.searchInput;\n  var SelectTextInput = customSearchInput || TextInput;\n  var selectOptionsStyle = theme.select.options ? _extends({}, theme.select.options.box, theme.select.options.container) : {};\n  return /*#__PURE__*/React.createElement(Keyboard, {\n    onEnter: onSelectOption,\n    onUp: onPreviousOption,\n    onDown: onNextOption,\n    onKeyDown: onKeyDown\n  }, /*#__PURE__*/React.createElement(StyledContainer, {\n    ref: ref,\n    as: Box,\n    id: id ? id + \"__select-drop\" : undefined,\n    dropHeight: dropHeight\n  }, onSearch && /*#__PURE__*/React.createElement(Box, {\n    pad: !customSearchInput ? 'xsmall' : undefined,\n    flex: false\n  }, /*#__PURE__*/React.createElement(SelectTextInput, {\n    focusIndicator: !customSearchInput,\n    size: \"small\",\n    ref: searchRef,\n    type: \"search\",\n    value: search || '',\n    placeholder: searchPlaceholder,\n    onChange: function onChange(event) {\n      var nextSearch = event.target.value;\n      setSearch(nextSearch);\n      setActiveIndex(-1);\n      onSearch(nextSearch);\n    }\n  })), clear && clear.position !== 'bottom' && value && /*#__PURE__*/React.createElement(ClearButton, {\n    clear: clear,\n    name: name,\n    onClear: onClear,\n    theme: theme,\n    setFocus: setFocus\n  }), /*#__PURE__*/React.createElement(OptionsBox, {\n    role: \"menubar\",\n    tabIndex: \"-1\",\n    ref: optionsRef\n  }, options.length > 0 ? /*#__PURE__*/React.createElement(InfiniteScroll, {\n    items: options,\n    step: theme.select.step,\n    onMore: onMore,\n    replace: replace,\n    show: activeIndex !== -1 ? activeIndex : undefined\n  }, function (option, index, optionRef) {\n    var optionDisabled = isDisabled(index);\n    var optionSelected = isSelected(index);\n    var optionActive = activeIndex === index; // Determine whether the label is done as a child or\n    // as an option Button kind property.\n\n    var child;\n    if (children) child = children(option, index, options, {\n      active: optionActive,\n      disabled: optionDisabled,\n      selected: optionSelected\n    });else if (theme.select.options) child = /*#__PURE__*/React.createElement(OptionBox, _extends({}, selectOptionsStyle, {\n      selected: optionSelected\n    }), /*#__PURE__*/React.createElement(Text, theme.select.options.text, optionLabel(index))); // if we have a child, turn on plain, and hoverIndicator\n\n    return /*#__PURE__*/React.createElement(SelectOption // eslint-disable-next-line react/no-array-index-key\n    , {\n      key: index,\n      ref: optionRef,\n      tabIndex: \"-1\",\n      role: \"menuitem\",\n      plain: !child ? undefined : true,\n      align: \"start\",\n      kind: !child ? 'option' : undefined,\n      hoverIndicator: !child ? undefined : 'background',\n      label: !child ? optionLabel(index) : undefined,\n      disabled: optionDisabled || undefined,\n      active: optionActive,\n      selected: optionSelected,\n      option: option,\n      onMouseOver: !optionDisabled ? onActiveOption(index) : undefined,\n      onClick: !optionDisabled ? selectOption(index) : undefined\n    }, child);\n  }) : /*#__PURE__*/React.createElement(SelectOption, {\n    key: \"search_empty\",\n    tabIndex: \"-1\",\n    role: \"menuitem\",\n    hoverIndicator: \"background\",\n    disabled: true,\n    option: emptySearchMessage\n  }, /*#__PURE__*/React.createElement(OptionBox, selectOptionsStyle, /*#__PURE__*/React.createElement(Text, theme.select.container.text, emptySearchMessage)))), clear && clear.position === 'bottom' && value && /*#__PURE__*/React.createElement(ClearButton, {\n    clear: clear,\n    name: name,\n    onClear: onClear,\n    theme: theme,\n    setFocus: setFocus\n  })));\n});\nexport { SelectContainer };"]},"metadata":{},"sourceType":"module"}